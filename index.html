<script>
function send() {
  const file = document.getElementById("file").files[0];
  if (!file) {
    alert("画像を選んでね");
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    const img = document.getElementById("preview");
    img.src = reader.result;
    img.style.display = "block";

    const score = Math.floor(70 + Math.random() * 25);
    const rank = score >= 90 ? "S" : score >= 80 ? "A" : "B";

    document.getElementById("result").innerHTML = `
      <b>診断結果</b><br>
      黄金比：${score}%<br>
      ランク：${rank}
    `;

    fetch("/.netlify/functions/send", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        score,
        rank,
        image: reader.result   // ← 画像を送る
      })
    }).catch(err => console.error(err));
  };

  reader.readAsDataURL(file);
}
</script>
